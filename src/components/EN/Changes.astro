---
import { Image } from "astro:assets";
import {
  sandraAntes,
  sandraDespues,
  ursuaAntes,
  ursuaDespues,
  ivanAntes,
  ivanDespues,
  pepeAntes,
  pepeDespues,
  tejadaAntes,
  tejadaDespues,
  infAntes,
  infDespues,
} from "../../images";
---

<section id="changes" class="pt-28 px-4 sm:px-16">
  <h2 class="flex justify-center pb-6 font-semibold text-3xl">
    Transform your smile
  </h2>
  <div class="grid grid-cols-2 md:grid-cols-3 gap-1">
    <div
      class="relative w-full max-w-4xl mx-auto overflow-hidden rounded-lg aspect-[16/9]"
    >
      <Image
        src={sandraAntes}
        alt="Before"
        width={800}
        height={450}
        class="aspect-auto absolute inset-0 w-auto h-auto object-cover before-image"
      />
      <div class="absolute inset-0 w-auto h-auto overflow-hidden">
        <Image
          src={sandraDespues}
          alt="After"
          width={800}
          height={450}
          class="aspect-auto absolute inset-0 w-auto h-auto object-cover [clip-path:inset(0_50%_0_0)] after-image"
        />
      </div>
      <div
        class="absolute top-0 left-1/2 w-[2px] h-full bg-white z-10 sm:w-[4px] divider"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full z-20 sm:w-7 sm:h-7 handle"
      >
      </div>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="absolute inset-0 w-auto h-auto opacity-0 cursor-pointer z-30 slider"
        aria-label="Image Comparison"
      />
    </div>
    <div
      class="relative w-full max-w-4xl mx-auto overflow-hidden rounded-lg aspect-[16/9]"
    >
      <Image
        src={ursuaAntes}
        alt="Before"
        width={800}
        height={450}
        class="aspect-auto absolute inset-0 w-auto h-auto object-cover before-image"
      />
      <div class="absolute inset-0 w-auto h-auto overflow-hidden">
        <Image
          src={ursuaDespues}
          alt="After"
          width={800}
          height={450}
          class="aspect-auto absolute inset-0 w-auto h-auto object-cover [clip-path:inset(0_50%_0_0)] after-image"
        />
      </div>
      <div
        class="absolute top-0 left-1/2 w-[2px] h-full bg-white z-10 sm:w-[4px] divider"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full z-20 sm:w-7 sm:h-7 handle"
      >
      </div>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="absolute inset-0 w-auto h-auto opacity-0 cursor-pointer z-30 slider"
        aria-label="Image Comparison"
      />
    </div>
    <div
      class="relative w-full max-w-4xl mx-auto overflow-hidden rounded-lg aspect-[16/9]"
    >
      <Image
        src={ivanAntes}
        alt="Before"
        width={800}
        height={450}
        class="aspect-auto absolute inset-0 w-auto h-auto object-cover before-image"
      />
      <div class="absolute inset-0 w-auto h-auto overflow-hidden">
        <Image
          src={ivanDespues}
          alt="After"
          width={800}
          height={450}
          class="aspect-auto absolute inset-0 w-auto h-auto object-cover [clip-path:inset(0_50%_0_0)] after-image"
        />
      </div>
      <div
        class="absolute top-0 left-1/2 w-[2px] h-full bg-white z-10 sm:w-[4px] divider"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full z-20 sm:w-7 sm:h-7 handle"
      >
      </div>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="absolute inset-0 w-auto h-auto opacity-0 cursor-pointer z-30 slider"
        aria-label="Image Comparison"
      />
    </div>
    <div
      class="relative w-full max-w-4xl mx-auto overflow-hidden rounded-lg aspect-[16/9]"
    >
      <Image
        src={pepeAntes}
        alt="Before"
        width={800}
        height={450}
        class="aspect-auto absolute inset-0 w-auto h-auto object-cover before-image"
      />
      <div class="absolute inset-0 w-auto h-auto overflow-hidden">
        <Image
          src={pepeDespues}
          alt="After"
          width={800}
          height={450}
          class="aspect-auto absolute inset-0 w-auto h-auto object-cover [clip-path:inset(0_50%_0_0)] after-image"
        />
      </div>
      <div
        class="absolute top-0 left-1/2 w-[2px] h-full bg-white z-10 sm:w-[4px] divider"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full z-20 sm:w-7 sm:h-7 handle"
      >
      </div>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="absolute inset-0 w-auto h-auto opacity-0 cursor-pointer z-30 slider"
        aria-label="Image Comparison"
      />
    </div>
    <div
      class="relative w-full max-w-4xl mx-auto overflow-hidden rounded-lg aspect-[16/9]"
    >
      <Image
        src={tejadaAntes}
        alt="Before"
        width={800}
        height={450}
        class="aspect-auto absolute inset-0 w-auto h-auto object-cover before-image"
      />
      <div class="absolute inset-0 w-auto h-auto overflow-hidden">
        <Image
          src={tejadaDespues}
          alt="After"
          width={800}
          height={450}
          class="aspect-auto absolute inset-0 w-auto h-auto object-cover [clip-path:inset(0_50%_0_0)] after-image"
        />
      </div>
      <div
        class="absolute top-0 left-1/2 w-[2px] h-full bg-white z-10 sm:w-[4px] divider"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full z-20 sm:w-7 sm:h-7 handle"
      >
      </div>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="absolute inset-0 w-auto h-auto opacity-0 cursor-pointer z-30 slider"
        aria-label="Image Comparison"
      />
    </div>
    <div
      class="relative w-full max-w-4xl mx-auto overflow-hidden rounded-lg aspect-[16/9]"
    >
      <Image
        src={infAntes}
        alt="Before"
        width={800}
        height={450}
        class="aspect-auto absolute inset-0 w-auto h-auto object-cover before-image"
      />
      <div class="absolute inset-0 w-auto h-auto overflow-hidden">
        <Image
          src={infDespues}
          alt="After"
          width={800}
          height={450}
          class="aspect-auto absolute inset-0 w-auto h-auto object-cover [clip-path:inset(0_50%_0_0)] after-image"
        />
      </div>
      <div
        class="absolute top-0 left-1/2 w-[2px] h-full bg-white z-10 sm:w-[4px] divider"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full z-20 sm:w-7 sm:h-7 handle"
      >
      </div>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="absolute inset-0 w-auto h-auto opacity-0 cursor-pointer z-30 slider"
        aria-label="Image Comparison"
      />
    </div>
  </div>
</section>

<style>
  #changes {
    @media (min-width: 1400px) {
      margin: 0% 10%;
    }
  }

  .slider-animation {
    animation: slideEffect 4s ease;
  }

  @keyframes slideEffect {
    0% {
      left: 0%;
    }
    50% {
      left: 100%;
    }
    100% {
      left: 50%;
    }
  }

  .handle-animation {
    animation: handleEffect 4s ease;
  }

  @keyframes handleEffect {
    0% {
      left: 0%;
    }
    50% {
      left: 100%;
    }
    100% {
      left: 50%;
    }
  }

  .divider-animation {
    animation: dividerEffect 4s ease;
  }

  @keyframes dividerEffect {
    0% {
      left: 0%;
    }
    50% {
      left: 100%;
    }
    100% {
      left: 50%;
    }
  }

  .after-image-animation {
    animation: imageEffect 4s ease;
  }

  @keyframes imageEffect {
    0% {
      clip-path: inset(0 100% 0 0);
    }
    50% {
      clip-path: inset(0 0% 0 0);
    }
    100% {
      clip-path: inset(0 50% 0 0);
    }
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sliders = entry.target.querySelectorAll(".slider");
          sliders.forEach((slider) => {
            const container = slider.parentElement;
            if (!container) return;

            const afterImage = container.querySelector(".after-image");
            const divider = container.querySelector(".divider");
            const handle = container.querySelector(".handle");

            if (!afterImage || !divider || !handle) return;

            slider.classList.add("slider-animation");
            afterImage.classList.add("after-image-animation");
            divider.classList.add("divider-animation");
            handle.classList.add("handle-animation");

            setTimeout(() => {
              slider.classList.remove("slider-animation");
              afterImage.classList.remove("after-image-animation");
              divider.classList.remove("divider-animation");
              handle.classList.remove("handle-animation");
            }, 4000);
          });
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.1,
    }
  );

  const changes = document.getElementById("changes");
  if (changes) {
    observer.observe(changes);
  }

  const sliders = document.querySelectorAll(".slider");
  const dividers = document.querySelectorAll(".divider");
  const handles = document.querySelectorAll(".handle");
  const afterImages = document.querySelectorAll(".after-image");

  sliders.forEach((slider, index) => {
    slider.addEventListener("input", (e) => {
      const value = e.target.value;
      afterImages[index].style.clipPath = `inset(0 ${100 - value}% 0 0)`;
      dividers[index].style.left = `${value}%`;
      handles[index].style.left = `${value}%`;
    });

    slider.addEventListener("touchmove", (e) => {
      const touch = (e as TouchEvent).touches[0];
      const rect = slider.getBoundingClientRect();
      const value = Math.max(
        0,
        Math.min(100, ((touch.clientX - rect.left) / rect.width) * 100)
      );
      (slider as HTMLInputElement).value = value;
      afterImages[index].style.clipPath = `inset(0 ${100 - value}% 0 0)`;
      dividers[index].style.left = `${value}%`;
      handles[index].style.left = `${value}%`;
    });
  });
</script>
