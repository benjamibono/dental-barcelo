---
import { Image } from "astro:assets";
import {
  sandraAntes,
  sandraDespues,
  ursuaAntes,
  ursuaDespues,
  ivanAntes,
  ivanDespues,
  pepeAntes,
  pepeDespues,
  tejadaAntes,
  tejadaDespues,
  infAntes,
  infDespues,
} from "../images";
---

<div class="w-full">
  <section id="cambios" class="py-16 sm:py-24 px-4 sm:px-8 max-w-7xl mx-auto">
    <h2
      class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-primary text-center mb-12 sm:mb-16"
    >
      Transforma tu sonrisa
    </h2>
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8"
    >
      <div
        class="relative w-full overflow-hidden rounded-xl shadow-md aspect-[16/9] group"
      >
        <Image
          src={sandraAntes}
          alt="Antes del tratamiento dental"
          width={800}
          height={450}
          class="absolute inset-0 w-full h-full object-cover before-image"
        />
        <div class="absolute inset-0 overflow-hidden">
          <Image
            src={sandraDespues}
            alt="Después del tratamiento dental"
            width={800}
            height={450}
            class="absolute inset-0 w-full h-full object-cover [clip-path:inset(0_50%_0_0)] after-image"
          />
        </div>
        <div
          class="absolute top-0 left-1/2 w-0.5 sm:w-1 h-full bg-white z-10 divider"
        >
        </div>
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-full shadow-lg z-20 handle"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-primary" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M8.59 16.59L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.41z"
              ></path>
              <path
                fill="currentColor"
                d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.41z"
                transform="rotate(180 12 12)"></path>
            </svg>
          </div>
        </div>
        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30 slider"
          aria-label="Deslizador de comparación de imágenes"
        />
      </div>

      <div
        class="relative w-full overflow-hidden rounded-xl shadow-md aspect-[16/9] group"
      >
        <Image
          src={ursuaAntes}
          alt="Antes del tratamiento dental"
          width={800}
          height={450}
          class="absolute inset-0 w-full h-full object-cover before-image"
        />
        <div class="absolute inset-0 overflow-hidden">
          <Image
            src={ursuaDespues}
            alt="Después del tratamiento dental"
            width={800}
            height={450}
            class="absolute inset-0 w-full h-full object-cover [clip-path:inset(0_50%_0_0)] after-image"
          />
        </div>
        <div
          class="absolute top-0 left-1/2 w-0.5 sm:w-1 h-full bg-white z-10 divider"
        >
        </div>
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-full shadow-lg z-20 handle"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-primary" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M8.59 16.59L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.41z"
              ></path>
              <path
                fill="currentColor"
                d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.41z"
                transform="rotate(180 12 12)"></path>
            </svg>
          </div>
        </div>
        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30 slider"
          aria-label="Deslizador de comparación de imágenes"
        />
      </div>

      <div
        class="relative w-full overflow-hidden rounded-xl shadow-md aspect-[16/9] group"
      >
        <Image
          src={ivanAntes}
          alt="Antes del tratamiento dental"
          width={800}
          height={450}
          class="absolute inset-0 w-full h-full object-cover before-image"
        />
        <div class="absolute inset-0 overflow-hidden">
          <Image
            src={ivanDespues}
            alt="Después del tratamiento dental"
            width={800}
            height={450}
            class="absolute inset-0 w-full h-full object-cover [clip-path:inset(0_50%_0_0)] after-image"
          />
        </div>
        <div
          class="absolute top-0 left-1/2 w-0.5 sm:w-1 h-full bg-white z-10 divider"
        >
        </div>
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-full shadow-lg z-20 handle"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-primary" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M8.59 16.59L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.41z"
              ></path>
              <path
                fill="currentColor"
                d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.41z"
                transform="rotate(180 12 12)"></path>
            </svg>
          </div>
        </div>
        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30 slider"
          aria-label="Deslizador de comparación de imágenes"
        />
      </div>

      <div
        class="relative w-full overflow-hidden rounded-xl shadow-md aspect-[16/9] group"
      >
        <Image
          src={pepeAntes}
          alt="Antes del tratamiento dental"
          width={800}
          height={450}
          class="absolute inset-0 w-full h-full object-cover before-image"
        />
        <div class="absolute inset-0 overflow-hidden">
          <Image
            src={pepeDespues}
            alt="Después del tratamiento dental"
            width={800}
            height={450}
            class="absolute inset-0 w-full h-full object-cover [clip-path:inset(0_50%_0_0)] after-image"
          />
        </div>
        <div
          class="absolute top-0 left-1/2 w-0.5 sm:w-1 h-full bg-white z-10 divider"
        >
        </div>
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-full shadow-lg z-20 handle"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-primary" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M8.59 16.59L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.41z"
              ></path>
              <path
                fill="currentColor"
                d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.41z"
                transform="rotate(180 12 12)"></path>
            </svg>
          </div>
        </div>
        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30 slider"
          aria-label="Deslizador de comparación de imágenes"
        />
      </div>

      <div
        class="relative w-full overflow-hidden rounded-xl shadow-md aspect-[16/9] group"
      >
        <Image
          src={tejadaAntes}
          alt="Antes del tratamiento dental"
          width={800}
          height={450}
          class="absolute inset-0 w-full h-full object-cover before-image"
        />
        <div class="absolute inset-0 overflow-hidden">
          <Image
            src={tejadaDespues}
            alt="Después del tratamiento dental"
            width={800}
            height={450}
            class="absolute inset-0 w-full h-full object-cover [clip-path:inset(0_50%_0_0)] after-image"
          />
        </div>
        <div
          class="absolute top-0 left-1/2 w-0.5 sm:w-1 h-full bg-white z-10 divider"
        >
        </div>
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-full shadow-lg z-20 handle"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-primary" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M8.59 16.59L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.41z"
              ></path>
              <path
                fill="currentColor"
                d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.41z"
                transform="rotate(180 12 12)"></path>
            </svg>
          </div>
        </div>
        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30 slider"
          aria-label="Deslizador de comparación de imágenes"
        />
      </div>

      <div
        class="relative w-full overflow-hidden rounded-xl shadow-md aspect-[16/9] group"
      >
        <Image
          src={infAntes}
          alt="Antes del tratamiento dental"
          width={800}
          height={450}
          class="absolute inset-0 w-full h-full object-cover before-image"
        />
        <div class="absolute inset-0 overflow-hidden">
          <Image
            src={infDespues}
            alt="Después del tratamiento dental"
            width={800}
            height={450}
            class="absolute inset-0 w-full h-full object-cover [clip-path:inset(0_50%_0_0)] after-image"
          />
        </div>
        <div
          class="absolute top-0 left-1/2 w-0.5 sm:w-1 h-full bg-white z-10 divider"
        >
        </div>
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-full shadow-lg z-20 handle"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-primary" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M8.59 16.59L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.41z"
              ></path>
              <path
                fill="currentColor"
                d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.41z"
                transform="rotate(180 12 12)"></path>
            </svg>
          </div>
        </div>
        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30 slider"
          aria-label="Deslizador de comparación de imágenes"
        />
      </div>
    </div>
  </section>
</div>

<style>
  .slider-animation {
    animation: slideEffect 4s ease;
  }

  @keyframes slideEffect {
    0% {
      left: 0%;
    }
    50% {
      left: 100%;
    }
    100% {
      left: 50%;
    }
  }

  .handle-animation {
    animation: handleEffect 4s ease;
  }

  @keyframes handleEffect {
    0% {
      left: 0%;
    }
    50% {
      left: 100%;
    }
    100% {
      left: 50%;
    }
  }

  .divider-animation {
    animation: dividerEffect 4s ease;
  }

  @keyframes dividerEffect {
    0% {
      left: 0%;
    }
    50% {
      left: 100%;
    }
    100% {
      left: 50%;
    }
  }

  .after-image-animation {
    animation: imageEffect 4s ease;
  }

  @keyframes imageEffect {
    0% {
      clip-path: inset(0 100% 0 0);
    }
    50% {
      clip-path: inset(0 0% 0 0);
    }
    100% {
      clip-path: inset(0 50% 0 0);
    }
  }

  .group:hover .handle {
    transform: translate(-50%, -50%) scale(1.1);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .handle {
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sliders = entry.target.querySelectorAll(".slider");
          sliders.forEach((slider) => {
            const container = slider.parentElement;
            if (!container) return;

            const afterImage = container.querySelector(".after-image");
            const divider = container.querySelector(".divider");
            const handle = container.querySelector(".handle");

            if (!afterImage || !divider || !handle) return;

            slider.classList.add("slider-animation");
            afterImage.classList.add("after-image-animation");
            divider.classList.add("divider-animation");
            handle.classList.add("handle-animation");

            setTimeout(() => {
              slider.classList.remove("slider-animation");
              afterImage.classList.remove("after-image-animation");
              divider.classList.remove("divider-animation");
              handle.classList.remove("handle-animation");
            }, 4000);
          });
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.2,
      rootMargin: "50px",
    }
  );

  const changes = document.getElementById("cambios");
  if (changes) {
    observer.observe(changes);
  }

  const sliders = document.querySelectorAll<HTMLInputElement>(".slider");
  const dividers = document.querySelectorAll<HTMLElement>(".divider");
  const handles = document.querySelectorAll<HTMLElement>(".handle");
  const afterImages = document.querySelectorAll<HTMLElement>(".after-image");

  sliders.forEach((slider, index) => {
    slider.addEventListener("input", (e) => {
      const target = e.target as HTMLInputElement;
      const value = target.value;
      afterImages[index].style.clipPath =
        `inset(0 ${100 - Number(value)}% 0 0)`;
      dividers[index].style.left = `${value}%`;
      handles[index].style.left = `${value}%`;
    });

    slider.addEventListener("touchmove", (e) => {
      const touch = e.touches[0];
      const rect = slider.getBoundingClientRect();
      const value = Math.max(
        0,
        Math.min(100, ((touch.clientX - rect.left) / rect.width) * 100)
      );
      slider.value = String(value);
      afterImages[index].style.clipPath = `inset(0 ${100 - value}% 0 0)`;
      dividers[index].style.left = `${value}%`;
      handles[index].style.left = `${value}%`;
    });
  });
</script>
